<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Plist4r::Backend::CFPropertyList::Binary</title>
<link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../../css/custom.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>
<base id="base_target" target="_top" />
<script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../js/autocomplete.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>
<script type="text/javascript" charset="utf-8" src="../../../js/live.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
		
			<a href="../../../object_index.html" target="_self" title="Index (B)">Index (B)</a>
		 &raquo;
    <span class='title'><a href="../../../Plist4r.html" target="_self" title="Plist4r (module)">Plist4r</a></span> &raquo; <span class='title'><a href="../../Backend.html" target="_self" title="Plist4r::Backend (class)">Backend</a></span> &raquo; <span class='title'><a href="../CFPropertyList.html" target="_self" title="Plist4r::Backend::CFPropertyList (module)">CFPropertyList</a></span>
     &raquo; 
    <span class="title">Binary</span>
  
  
  <div class="noframes">
    <span class="title"></span>
    <a id="frames_link" class="link_disabled">Frames</a> | 
    <a target="_top" id="noframes_link" class="link_disabled">No Frames</a>
    <span class="title"></span>
  </div>
</div>

      <div id="search2">
  
  
  <div class="search2_center">
    <form class="search2" onsubmit="return false;" action="">
      <input name="q" type="search" placeholder="Search" id="search_box2" size="30" value="" />
    </form>
  </div>
  <script type="text/javascript" charset="utf-8"> 
    $('#search_box2').focus(function(){
      var search_index = relpath + 'search_index.json';
      jQuery.getJSON(search_index, go_data);

      function go_data(adata) {
        $('#search_box2').autocomplete(adata, {
          width: 300,
          matchContains: true,
          formatItem: function(item) {
            return item.text;
          }
        }).result(function(event, item) {
					if (window.location.search) {
	          window.location.href = relpath + $(item.href_tag).attr("href");
					} else {
	          location.href = relpath + $(item.href_tag).attr("href");
					}
        });
      }
    });
  </script> 
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Plist4r::Backend::CFPropertyList::Binary
  
  
  
</h1>

<div id="info_box">
  <dl class="box">
    
      
    
      
    
  
    <dt class="r1 last">Defined in:</dt>
		<dd class="r1 last">
  		
  lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb


		</dd>
  </dl>
</div>
<div class="clear"></div>


	<h3 class="inherited">Class Methods</h3>
	    <ul id="methods_ribbon">
	    
	    
	      <li class="r1"><a href="#binary_strlen-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.binary_strlen (method)">binary_strlen</a></li>
	      
	    
	      <li class="r2"><a href="#bytes_int-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.bytes_int (method)">bytes_int</a></li>
	      
	    
	      <li class="r1"><a href="#bytes_needed-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.bytes_needed (method)">bytes_needed</a></li>
	      
	    
	      <li class="r2"><a href="#bytes_size_int-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.bytes_size_int (method)">bytes_size_int</a></li>
	      
	    
	      <li class="r1"><a href="#charset_convert-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.charset_convert (method)">charset_convert</a></li>
	      
	    
	      <li class="r2"><a href="#charset_strlen-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.charset_strlen (method)">charset_strlen</a></li>
	      
	    
	      <li class="r1"><a href="#int_bytes-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.int_bytes (method)">int_bytes</a></li>
	      
	    
	      <li class="r2"><a href="#pack_it_with_size-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.pack_it_with_size (method)">pack_it_with_size</a></li>
	      
	    
	      <li class="r1"><a href="#type_bytes-class_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary.type_bytes (method)">type_bytes</a></li>
	      
	    
	    </ul>

	<h3 class="inherited">Instance Methods</h3>
	    <ul id="methods_ribbon">
	    
	    
	      <li class="r1"><a href="#array_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#array_to_binary (method)">array_to_binary</a></li>
	      
	    
	      <li class="r2"><a href="#bool_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#bool_to_binary (method)">bool_to_binary</a></li>
	      
	    
	      <li class="r1"><a href="#data_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#data_to_binary (method)">data_to_binary</a></li>
	      
	    
	      <li class="r2"><a href="#date_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#date_to_binary (method)">date_to_binary</a></li>
	      
	    
	      <li class="r1"><a href="#dict_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#dict_to_binary (method)">dict_to_binary</a></li>
	      
	    
	      <li class="r2"><a href="#int_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#int_to_binary (method)">int_to_binary</a></li>
	      
	    
	      <li class="r1"><a href="#load-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#load (method)">load</a></li>
	      
	    
	      <li class="r2"><a href="#num_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#num_to_binary (method)">num_to_binary</a></li>
	      
	    
	      <li class="r1"><a href="#real_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#real_to_binary (method)">real_to_binary</a></li>
	      
	    
	      <li class="r2"><a href="#string_to_binary-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#string_to_binary (method)">string_to_binary</a></li>
	      
	    
	      <li class="r1"><a href="#to_str-instance_method" target="_self" title="Plist4r::Backend::CFPropertyList::Binary#to_str (method)">to_str</a></li>
	      
	    
	    </ul>





  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first" id="binary_strlen-class_method">
  <p class="signature first"">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>binary_strlen</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Counts the number of bytes the string will have when coded; utf-16be if
non-ascii characters are present.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


501
502
503
504
505
506
507
508
509
510</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 501</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='binary_strlen identifier id'>binary_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='each_byte identifier id'>each_byte</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='b identifier id'>b</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='gt op'>&gt;</span> <span class='integer val'>127</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_convert identifier id'>charset_convert</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span> <span class='string val'>'UTF-8'</span><span class='comma token'>,</span> <span class='string val'>'UTF-16BE'</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="bytes_int-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>bytes_int</strong>(int) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Calculate the byte needed for a „normal” integer value
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


361
362
363
364
365
366
367
368
369
370</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 361</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_int identifier id'>bytes_int</span><span class='lparen token'>(</span><span class='int identifier id'>int</span><span class='rparen token'>)</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>1</span>

  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span> <span class='comment val'># 2 byte int</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span> <span class='comment val'># 4 byte int</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>4</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFFFFFF constant id'>FFFFFFFF</span> <span class='comment val'># 8 byte int</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>7</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='comment val'># 8 byte int (since it is signed)</span>

  <span class='return return kw'>return</span> <span class='nbytes identifier id'>nbytes</span> <span class='plus op'>+</span> <span class='integer val'>1</span> <span class='comment val'># one „marker” byte</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="bytes_needed-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>bytes_needed</strong>(count) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
calculate how many bytes are needed to save <tt>count</tt>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 385</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_needed identifier id'>bytes_needed</span><span class='lparen token'>(</span><span class='count identifier id'>count</span><span class='rparen token'>)</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

    <span class='while while kw'>while</span> <span class='count identifier id'>count</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span> <span class='do do kw'>do</span>
      <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='count identifier id'>count</span> <span class='opasgn op'>/=</span> <span class='integer val'>256</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='nbytes identifier id'>nbytes</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># create integer bytes of +int+</span>
  <span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='int_bytes identifier id'>int_bytes</span><span class='lparen token'>(</span><span class='int identifier id'>int</span><span class='rparen token'>)</span>
    <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x12&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;N&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 4 byte integer</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x11&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;n&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 2 byte integer</span>
    <span class='else else kw'>else</span>
      <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x10&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;C&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 8 byte integer</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='intbytes identifier id'>intbytes</span><span class='semicolon token'>;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Create a type byte for binary format as defined by apple</span>
  <span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
    <span class='optional_int identifier id'>optional_int</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='type_len identifier id'>type_len</span> <span class='lt op'>&lt;</span> <span class='integer val'>15</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='type identifier id'>type</span> <span class='opasgn op'>+=</span> <span class='sprintf identifier id'>sprintf</span><span class='lparen token'>(</span><span class='string val'>&quot;%x&quot;</span><span class='comma token'>,</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='type identifier id'>type</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;f&quot;</span>
      <span class='optional_int identifier id'>optional_int</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='int_bytes identifier id'>int_bytes</span><span class='lparen token'>(</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;H*&quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='optional_int identifier id'>optional_int</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># „unique” and count values. „Unique” means, several objects (e.g. strings)</span>
  <span class='comment val'># will only be saved once and referenced later</span>
  <span class='def def kw'>def</span> <span class='unique_and_count_values identifier id'>unique_and_count_values</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='comment val'># no uniquing for other types than CFString and CFData</span>
    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFInteger constant id'>CFInteger</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFReal constant id'>CFReal</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
      <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFInteger constant id'>CFInteger</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_int identifier id'>bytes_int</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='integer val'>9</span> <span class='comment val'># 9 bytes (8 + marker byte) for real</span>
      <span class='end end kw'>end</span>

      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='return return kw'>return</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFDate constant id'>CFDate</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='integer val'>9</span>
      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='return return kw'>return</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFBoolean constant id'>CFBoolean</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='return return kw'>return</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFArray constant id'>CFArray</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='cnt identifier id'>cnt</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

      <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
        <span class='cnt identifier id'>cnt</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='unique_and_count_values identifier id'>unique_and_count_values</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span>
        <span class='@object_refs ivar id'>@object_refs</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='comment val'># each array member is a ref</span>
      <span class='end end kw'>end</span>

      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='cnt identifier id'>cnt</span><span class='rparen token'>)</span>
      <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='comment val'># marker byte for array</span>
      <span class='return return kw'>return</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFDictionary constant id'>CFDictionary</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='cnt identifier id'>cnt</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

      <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
        <span class='cnt identifier id'>cnt</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

        <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='notop op'>!</span><span class='@unique_table ivar id'>@unique_table</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
          <span class='@string_size ivar id'>@string_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='binary_strlen identifier id'>binary_strlen</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
          <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_strlen identifier id'>charset_strlen</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='string val'>'UTF-8'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>

        <span class='@object_refs ivar id'>@object_refs</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span> <span class='comment val'># both, key and value, are refs</span>
        <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='unique_and_count_values identifier id'>unique_and_count_values</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='comment val'># marker byte for dict</span>
      <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='cnt identifier id'>cnt</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFData constant id'>CFData</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='decoded_value identifier id'>decoded_value</span>
      <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span>
      <span class='@misc_size ivar id'>@misc_size</span> <span class='opasgn op'>+=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
      <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='return return kw'>return</span>
    <span class='end end kw'>end</span>

    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='notop op'>!</span><span class='@unique_table ivar id'>@unique_table</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='@string_size ivar id'>@string_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='binary_strlen identifier id'>binary_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
      <span class='@int_size ivar id'>@int_size</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_strlen identifier id'>charset_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='string val'>'UTF-8'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
  <span class='protected identifier id'>protected</span> <span class='symbol val'>:unique_and_count_values</span>

  <span class='comment val'># Counts the number of bytes the string will have when coded; utf-16be if non-ascii characters are present.</span>
  <span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='binary_strlen identifier id'>binary_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='each_byte identifier id'>each_byte</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='b identifier id'>b</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='gt op'>&gt;</span> <span class='integer val'>127</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_convert identifier id'>charset_convert</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span> <span class='string val'>'UTF-8'</span><span class='comma token'>,</span> <span class='string val'>'UTF-16BE'</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Uniques and transforms a string value to binary format and adds it to the object table</span>
  <span class='def def kw'>def</span> <span class='string_to_binary identifier id'>string_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='integer val'>-1</span>

    <span class='unless unless kw'>unless</span><span class='lparen token'>(</span><span class='@unique_table ivar id'>@unique_table</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
      <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

      <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='saved_object_count identifier id'>saved_object_count</span>
      <span class='utf16 identifier id'>utf16</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

      <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='each_byte identifier id'>each_byte</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='b identifier id'>b</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='gt op'>&gt;</span> <span class='integer val'>127</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
          <span class='utf16 identifier id'>utf16</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
          <span class='break break kw'>break</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='utf16 identifier id'>utf16</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;6&quot;</span><span class='comma token'>,</span><span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_strlen identifier id'>charset_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-8&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='comment val'># 6 is 0110, unicode string (utf16be)</span>
        <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_convert identifier id'>charset_convert</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-8&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-16BE&quot;</span><span class='rparen token'>)</span>

        <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='force_encoding identifier id'>force_encoding</span><span class='lparen token'>(</span><span class='string val'>&quot;ASCII-8BIT&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;encode&quot;</span><span class='rparen token'>)</span>
        <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>
      <span class='else else kw'>else</span>
        <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;5&quot;</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span><span class='rparen token'>)</span> <span class='comment val'># 5 is 0101 which is an ASCII string (seems to be ASCII encoded)</span>
        <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Codes an integer to binary format</span>
  <span class='def def kw'>def</span> <span class='int_to_binary identifier id'>int_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span> <span class='comment val'># 1 byte integer</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span> <span class='comment val'># 4 byte integer</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFFFFFF constant id'>FFFFFFFF</span> <span class='comment val'># 8 byte integer</span>
    <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>3</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='comment val'># 8 byte integer, since signed</span>

    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;1&quot;</span><span class='comma token'>,</span> <span class='nbytes identifier id'>nbytes</span><span class='rparen token'>)</span> <span class='comment val'># 1 is 0001, type indicator for integer</span>
    <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='lt op'>&lt;</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;N&quot;</span>

      <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;C&quot;</span>
      <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
        <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;n&quot;</span>
      <span class='end end kw'>end</span>

      <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># 64 bit signed integer; we need the higher and the lower 32 bit of the value</span>
      <span class='high_word identifier id'>high_word</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span> <span class='rshft op'>&gt;&gt;</span> <span class='integer val'>32</span>
      <span class='low_word identifier id'>low_word</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span> <span class='bitand op'>&amp;</span> <span class='integer val'>0x</span><span class='FFFFFFFF constant id'>FFFFFFFF</span>
      <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='high_word identifier id'>high_word</span><span class='comma token'>,</span><span class='low_word identifier id'>low_word</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;NN&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='buff identifier id'>buff</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Codes a real value to binary format</span>
  <span class='def def kw'>def</span> <span class='real_to_binary identifier id'>real_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;2&quot;</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span> <span class='comment val'># 2 is 0010, type indicator for reals</span>
    <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='buff identifier id'>buff</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Converts a numeric value to binary and adds it to the object table</span>
  <span class='def def kw'>def</span> <span class='num_to_binary identifier id'>num_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFInteger constant id'>CFInteger</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='int_to_binary identifier id'>int_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='real_to_binary identifier id'>real_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Convert date value (apple format) to binary and adds it to the object table</span>
  <span class='def def kw'>def</span> <span class='date_to_binary identifier id'>date_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='getutc identifier id'>getutc</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='minus op'>-</span> <span class='CFDate constant id'>CFDate</span><span class='colon2 op'>::</span><span class='DATE_DIFF_APPLE_UNIX constant id'>DATE_DIFF_APPLE_UNIX</span> <span class='comment val'># CFDate is a real, number of seconds since 01/01/2001 00:00:00 GMT</span>

    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;3&quot;</span><span class='comma token'>,</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='comment val'># 3 is 0011, type indicator for date</span>
    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span>

    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Convert a bool value to binary and add it to the object table</span>
  <span class='def def kw'>def</span> <span class='bool_to_binary identifier id'>bool_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span> <span class='integer val'>? </span><span class='string val'>&quot;\x9&quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;\x8&quot;</span> <span class='comment val'># 0x9 is 1001, type indicator for true; 0x8 is 1000, type indicator for false</span>
    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Convert data value to binary format and add it to the object table</span>
  <span class='def def kw'>def</span> <span class='data_to_binary identifier id'>data_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;4&quot;</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span><span class='rparen token'>)</span> <span class='comment val'># a is 1000, type indicator for data</span>
    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>

    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Convert array to binary format and add it to the object table</span>
  <span class='def def kw'>def</span> <span class='array_to_binary identifier id'>array_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;a&quot;</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='rparen token'>)</span> <span class='comment val'># a is 1010, type indicator for arrays</span>

    <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span>  <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
    <span class='end end kw'>end</span>

    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span>
    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Convert dictionary to binary format and add it to the object table</span>
  <span class='def def kw'>def</span> <span class='dict_to_binary identifier id'>dict_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='rparen token'>)</span> <span class='comment val'># d=1101, type indicator for dictionary</span>

    <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each_key identifier id'>each_key</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span>
      <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='CFString constant id'>CFString</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='rparen token'>)</span>
      <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
      <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each_value identifier id'>each_value</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span>
    <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="bytes_size_int-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>bytes_size_int</strong>(int) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
calculate the bytes needed for a size integer value
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


350
351
352
353
354
355
356
357
358</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 350</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_size_int identifier id'>bytes_size_int</span><span class='lparen token'>(</span><span class='int identifier id'>int</span><span class='rparen token'>)</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='E constant id'>E</span> <span class='comment val'># 2 bytes int</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span> <span class='comment val'># 3 bytes int</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span> <span class='if if_mod kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span> <span class='comment val'># 5 bytes int</span>

  <span class='return return kw'>return</span> <span class='nbytes identifier id'>nbytes</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="charset_convert-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>charset_convert</strong>(str, from, to = &quot;UTF-8&quot;) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert the given string from one charset to another
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 229</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_convert identifier id'>charset_convert</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='comma token'>,</span><span class='from identifier id'>from</span><span class='comma token'>,</span><span class='to identifier id'>to</span><span class='assign token'>=</span><span class='string val'>&quot;UTF-8&quot;</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span><span class='dot token'>.</span><span class='force_encoding identifier id'>force_encoding</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='encode identifier id'>encode</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;encode&quot;</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='conv identifier id'>conv</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='comma token'>,</span><span class='from identifier id'>from</span><span class='comma token'>,</span><span class='str identifier id'>str</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="charset_strlen-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>charset_strlen</strong>(str, charset = &quot;UTF-8&quot;) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Count characters considering character set
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 235</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_strlen identifier id'>charset_strlen</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='comma token'>,</span><span class='charset identifier id'>charset</span><span class='assign token'>=</span><span class='string val'>&quot;UTF-8&quot;</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='if if_mod kw'>if</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;encode&quot;</span><span class='rparen token'>)</span>

  <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='Iconv constant id'>Iconv</span><span class='dot token'>.</span><span class='conv identifier id'>conv</span><span class='lparen token'>(</span><span class='string val'>&quot;UTF-8&quot;</span><span class='comma token'>,</span><span class='charset identifier id'>charset</span><span class='comma token'>,</span><span class='str identifier id'>str</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='charset identifier id'>charset</span> <span class='neq op'>!=</span> <span class='string val'>&quot;UTF-8&quot;</span>
  <span class='return return kw'>return</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/./</span><span class='mu identifier id'>mu</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="int_bytes-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>int_bytes</strong>(int) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
create integer bytes of <tt>int</tt>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399
400
401
402
403
404
405
406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 397</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='int_bytes identifier id'>int_bytes</span><span class='lparen token'>(</span><span class='int identifier id'>int</span><span class='rparen token'>)</span>
  <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x12&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;N&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 4 byte integer</span>
  <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x11&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;n&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 2 byte integer</span>
  <span class='else else kw'>else</span>
    <span class='intbytes identifier id'>intbytes</span> <span class='assign token'>=</span> <span class='string val'>&quot;\x10&quot;</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;C&quot;</span><span class='rparen token'>)</span> <span class='comment val'># 8 byte integer</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='intbytes identifier id'>intbytes</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="pack_it_with_size-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>pack_it_with_size</strong>(nbytes, int) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
pack an <tt>int</tt> of <tt>nbytes</tt> with size
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


373
374
375
376
377
378
379
380
381
382</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 373</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span><span class='comma token'>,</span><span class='int identifier id'>int</span><span class='rparen token'>)</span>
  <span class='format identifier id'>format</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>&quot;C&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;n&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;N&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;N&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='nbytes identifier id'>nbytes</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rbrack token'>]</span>

  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='eq op'>==</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='format identifier id'>format</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='slice identifier id'>slice</span><span class='lparen token'>(</span><span class='integer val'>-3</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='int identifier id'>int</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='format identifier id'>format</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="type_bytes-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>type_bytes</strong>(type, type_len) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Create a type byte for binary format as defined by apple
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415
416
417
418
419
420
421
422
423</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 412</span>

<span class='def def kw'>def</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
  <span class='optional_int identifier id'>optional_int</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='type_len identifier id'>type_len</span> <span class='lt op'>&lt;</span> <span class='integer val'>15</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='type identifier id'>type</span> <span class='opasgn op'>+=</span> <span class='sprintf identifier id'>sprintf</span><span class='lparen token'>(</span><span class='string val'>&quot;%x&quot;</span><span class='comma token'>,</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='type identifier id'>type</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;f&quot;</span>
    <span class='optional_int identifier id'>optional_int</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='int_bytes identifier id'>int_bytes</span><span class='lparen token'>(</span><span class='type_len identifier id'>type_len</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;H*&quot;</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='optional_int identifier id'>optional_int</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first" id="array_to_binary-instance_method">
  <p class="signature first"">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>array_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert array to binary format and add it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


635
636
637
638
639
640
641
642
643
644
645
646
647</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 635</span>

<span class='def def kw'>def</span> <span class='array_to_binary identifier id'>array_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;a&quot;</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='rparen token'>)</span> <span class='comment val'># a is 1010, type indicator for arrays</span>

  <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span>  <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='end end kw'>end</span>

  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span>
  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="bool_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>bool_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert a bool value to binary and add it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


615
616
617
618
619
620
621</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 615</span>

<span class='def def kw'>def</span> <span class='bool_to_binary identifier id'>bool_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span> <span class='integer val'>? </span><span class='string val'>&quot;\x9&quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;\x8&quot;</span> <span class='comment val'># 0x9 is 1001, type indicator for true; 0x8 is 1000, type indicator for false</span>
  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="data_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>data_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert data value to binary format and add it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


624
625
626
627
628
629
630
631
632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 624</span>

<span class='def def kw'>def</span> <span class='data_to_binary identifier id'>data_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;4&quot;</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span><span class='rparen token'>)</span> <span class='comment val'># a is 1000, type indicator for data</span>
  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>

  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="date_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>date_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert date value (apple format) to binary and adds it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


602
603
604
605
606
607
608
609
610
611
612</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 602</span>

<span class='def def kw'>def</span> <span class='date_to_binary identifier id'>date_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='getutc identifier id'>getutc</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='minus op'>-</span> <span class='CFDate constant id'>CFDate</span><span class='colon2 op'>::</span><span class='DATE_DIFF_APPLE_UNIX constant id'>DATE_DIFF_APPLE_UNIX</span> <span class='comment val'># CFDate is a real, number of seconds since 01/01/2001 00:00:00 GMT</span>

  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;3&quot;</span><span class='comma token'>,</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='comment val'># 3 is 0011, type indicator for date</span>
  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span>

  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="dict_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>dict_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert dictionary to binary format and add it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 650</span>

<span class='def def kw'>def</span> <span class='dict_to_binary identifier id'>dict_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='rparen token'>)</span> <span class='comment val'># d=1101, type indicator for dictionary</span>

  <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each_key identifier id'>each_key</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span>
    <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='CFString constant id'>CFString</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='rparen token'>)</span>
    <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='each_value identifier id'>each_value</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='bdata identifier id'>bdata</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='@object_ref_size ivar id'>@object_ref_size</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span>
  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="int_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>int_to_binary</strong>(value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Codes an integer to binary format
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 548</span>

<span class='def def kw'>def</span> <span class='int_to_binary identifier id'>int_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FF constant id'>FF</span> <span class='comment val'># 1 byte integer</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFF constant id'>FFFF</span> <span class='comment val'># 4 byte integer</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='gt op'>&gt;</span> <span class='integer val'>0x</span><span class='FFFFFFFF constant id'>FFFFFFFF</span> <span class='comment val'># 8 byte integer</span>
  <span class='nbytes identifier id'>nbytes</span> <span class='assign token'>=</span> <span class='integer val'>3</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='comment val'># 8 byte integer, since signed</span>

  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;1&quot;</span><span class='comma token'>,</span> <span class='nbytes identifier id'>nbytes</span><span class='rparen token'>)</span> <span class='comment val'># 1 is 0001, type indicator for integer</span>
  <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='lt op'>&lt;</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;N&quot;</span>

    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;C&quot;</span>
    <span class='elsif elsif kw'>elsif</span><span class='lparen token'>(</span><span class='nbytes identifier id'>nbytes</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
      <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='string val'>&quot;n&quot;</span>
    <span class='end end kw'>end</span>

    <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># 64 bit signed integer; we need the higher and the lower 32 bit of the value</span>
    <span class='high_word identifier id'>high_word</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span> <span class='rshft op'>&gt;&gt;</span> <span class='integer val'>32</span>
    <span class='low_word identifier id'>low_word</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span> <span class='bitand op'>&amp;</span> <span class='integer val'>0x</span><span class='FFFFFFFF constant id'>FFFFFFFF</span>
    <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='high_word identifier id'>high_word</span><span class='comma token'>,</span><span class='low_word identifier id'>low_word</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;NN&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='buff identifier id'>buff</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="load-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>load</strong>(opts) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Read a binary plist file
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><a href="CFFormatError.html" target="_self" title="Plist4r::Backend::CFPropertyList::CFFormatError (class)">CFFormatError</a></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 16</span>

<span class='def def kw'>def</span> <span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='@unique_table ivar id'>@unique_table</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@count_objects ivar id'>@count_objects</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@string_size ivar id'>@string_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@int_size ivar id'>@int_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@misc_size ivar id'>@misc_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@object_refs ivar id'>@object_refs</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@object_table ivar id'>@object_table</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@object_ref_size ivar id'>@object_ref_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='@offsets ivar id'>@offsets</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='fd identifier id'>fd</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:file</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='fd identifier id'>fd</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:file</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='string val'>&quot;rb&quot;</span><span class='rparen token'>)</span>
    <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:file</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='fd identifier id'>fd</span> <span class='assign token'>=</span> <span class='StringIO constant id'>StringIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:data</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='string val'>&quot;rb&quot;</span><span class='rparen token'>)</span>
    <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;string&gt;&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># first, we read the trailer: 32 byte from the end</span>
  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='integer val'>-32</span><span class='comma token'>,</span><span class='IO constant id'>IO</span><span class='colon2 op'>::</span><span class='SEEK_END constant id'>SEEK_END</span><span class='rparen token'>)</span>
  <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>32</span><span class='rparen token'>)</span>

  <span class='offset_size identifier id'>offset_size</span><span class='comma token'>,</span> <span class='object_ref_size identifier id'>object_ref_size</span><span class='comma token'>,</span> <span class='number_of_objects identifier id'>number_of_objects</span><span class='comma token'>,</span> <span class='top_object identifier id'>top_object</span><span class='comma token'>,</span> <span class='table_offset identifier id'>table_offset</span> <span class='assign token'>=</span> <span class='buff identifier id'>buff</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span> <span class='string val'>&quot;x6CCx4Nx4Nx4N&quot;</span>

  <span class='comment val'># after that, get the offset table</span>
  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='table_offset identifier id'>table_offset</span><span class='comma token'>,</span> <span class='IO constant id'>IO</span><span class='colon2 op'>::</span><span class='SEEK_SET constant id'>SEEK_SET</span><span class='rparen token'>)</span>
  <span class='coded_offset_table identifier id'>coded_offset_table</span> <span class='assign token'>=</span> <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='number_of_objects identifier id'>number_of_objects</span> <span class='mult op'>*</span> <span class='offset_size identifier id'>offset_size</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='CFFormatError constant id'>CFFormatError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{file}: Format error!&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='coded_offset_table identifier id'>coded_offset_table</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span> <span class='eq op'>==</span> <span class='number_of_objects identifier id'>number_of_objects</span> <span class='mult op'>*</span> <span class='offset_size identifier id'>offset_size</span>

  <span class='@count_objects ivar id'>@count_objects</span> <span class='assign token'>=</span> <span class='number_of_objects identifier id'>number_of_objects</span>

  <span class='comment val'># decode offset table</span>
  <span class='formats identifier id'>formats</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;C*&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;n*&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;(H6)*&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;N*&quot;</span><span class='rbrack token'>]</span>
  <span class='@offsets ivar id'>@offsets</span> <span class='assign token'>=</span> <span class='coded_offset_table identifier id'>coded_offset_table</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='formats identifier id'>formats</span><span class='lbrack token'>[</span><span class='offset_size identifier id'>offset_size</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='offset_size identifier id'>offset_size</span> <span class='eq op'>==</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='integer val'>0</span><span class='dot token'>.</span><span class='upto identifier id'>upto</span><span class='lparen token'>(</span><span class='@offsets ivar id'>@offsets</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='@offsets ivar id'>@offsets</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@offsets ivar id'>@offsets</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='@object_ref_size ivar id'>@object_ref_size</span> <span class='assign token'>=</span> <span class='object_ref_size identifier id'>object_ref_size</span>
  <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='read_binary_object_at identifier id'>read_binary_object_at</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='comma token'>,</span><span class='fd identifier id'>fd</span><span class='comma token'>,</span><span class='top_object identifier id'>top_object</span><span class='rparen token'>)</span>

  <span class='fd identifier id'>fd</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='return return kw'>return</span> <span class='val identifier id'>val</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="num_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>num_to_binary</strong>(value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Converts a numeric value to binary and adds it to the object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


586
587
588
589
590
591
592
593
594
595
596
597
598
599</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 586</span>

<span class='def def kw'>def</span> <span class='num_to_binary identifier id'>num_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

  <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='CFInteger constant id'>CFInteger</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='int_to_binary identifier id'>int_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='real_to_binary identifier id'>real_to_binary</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="real_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>real_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Codes a real value to binary format
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


579
580
581
582
583</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 579</span>

<span class='def def kw'>def</span> <span class='real_to_binary identifier id'>real_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;2&quot;</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span> <span class='comment val'># 2 is 0010, type indicator for reals</span>
  <span class='buff identifier id'>buff</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;d&quot;</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='buff identifier id'>buff</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="string_to_binary-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>string_to_binary</strong>(val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Uniques and transforms a string value to binary format and adds it to the
object table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 513</span>

<span class='def def kw'>def</span> <span class='string_to_binary identifier id'>string_to_binary</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='integer val'>-1</span>

  <span class='unless unless kw'>unless</span><span class='lparen token'>(</span><span class='@unique_table ivar id'>@unique_table</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@written_object_count ivar id'>@written_object_count</span>
    <span class='@written_object_count ivar id'>@written_object_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='saved_object_count identifier id'>saved_object_count</span>
    <span class='utf16 identifier id'>utf16</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

    <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='each_byte identifier id'>each_byte</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='b identifier id'>b</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='gt op'>&gt;</span> <span class='integer val'>127</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='utf16 identifier id'>utf16</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
        <span class='break break kw'>break</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span><span class='lparen token'>(</span><span class='utf16 identifier id'>utf16</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
      <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;6&quot;</span><span class='comma token'>,</span><span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_strlen identifier id'>charset_strlen</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-8&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='comment val'># 6 is 0110, unicode string (utf16be)</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='charset_convert identifier id'>charset_convert</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-8&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;UTF-16BE&quot;</span><span class='rparen token'>)</span>

      <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='force_encoding identifier id'>force_encoding</span><span class='lparen token'>(</span><span class='string val'>&quot;ASCII-8BIT&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;encode&quot;</span><span class='rparen token'>)</span>
      <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>
    <span class='else else kw'>else</span>
      <span class='bdata identifier id'>bdata</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='type_bytes identifier id'>type_bytes</span><span class='lparen token'>(</span><span class='string val'>&quot;5&quot;</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span><span class='rparen token'>)</span> <span class='comment val'># 5 is 0101 which is an ASCII string (seems to be ASCII encoded)</span>
      <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='saved_object_count identifier id'>saved_object_count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='bdata identifier id'>bdata</span> <span class='plus op'>+</span> <span class='val identifier id'>val</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='saved_object_count identifier id'>saved_object_count</span> <span class='assign token'>=</span> <span class='@unique_table ivar id'>@unique_table</span><span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='saved_object_count identifier id'>saved_object_count</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="to_str-instance_method">
  <p class="signature "">
  
    - (<tt><a href="../../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>to_str</strong>(opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert CFPropertyList to binary format; since we have to count our objects
we simply unique CFDictionary and CFArray
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/c_f_property_list_old/rbBinaryCFPropertyList.rb', line 68</span>

<span class='def def kw'>def</span> <span class='to_str identifier id'>to_str</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='@unique_table ivar id'>@unique_table</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@count_objects ivar id'>@count_objects</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@string_size ivar id'>@string_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@int_size ivar id'>@int_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@misc_size ivar id'>@misc_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@object_refs ivar id'>@object_refs</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@object_table ivar id'>@object_table</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@object_ref_size ivar id'>@object_ref_size</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='@offsets ivar id'>@offsets</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='binary_str identifier id'>binary_str</span> <span class='assign token'>=</span> <span class='string val'>&quot;bplist00&quot;</span>
  <span class='unique_and_count_values identifier id'>unique_and_count_values</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:root</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='@count_objects ivar id'>@count_objects</span> <span class='opasgn op'>+=</span> <span class='@unique_table ivar id'>@unique_table</span><span class='dot token'>.</span><span class='count identifier id'>count</span>
  <span class='@object_ref_size ivar id'>@object_ref_size</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_needed identifier id'>bytes_needed</span><span class='lparen token'>(</span><span class='@count_objects ivar id'>@count_objects</span><span class='rparen token'>)</span>

  <span class='file_size identifier id'>file_size</span> <span class='assign token'>=</span> <span class='@string_size ivar id'>@string_size</span> <span class='plus op'>+</span> <span class='@int_size ivar id'>@int_size</span> <span class='plus op'>+</span> <span class='@misc_size ivar id'>@misc_size</span> <span class='plus op'>+</span> <span class='@object_refs ivar id'>@object_refs</span> <span class='mult op'>*</span> <span class='@object_ref_size ivar id'>@object_ref_size</span> <span class='plus op'>+</span> <span class='integer val'>40</span>
  <span class='offset_size identifier id'>offset_size</span> <span class='assign token'>=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='bytes_needed identifier id'>bytes_needed</span><span class='lparen token'>(</span><span class='file_size identifier id'>file_size</span><span class='rparen token'>)</span>
  <span class='table_offset identifier id'>table_offset</span> <span class='assign token'>=</span> <span class='file_size identifier id'>file_size</span> <span class='minus op'>-</span> <span class='integer val'>32</span>

  <span class='@object_table ivar id'>@object_table</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@written_object_count ivar id'>@written_object_count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@unique_table ivar id'>@unique_table</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='comment val'># we needed it to calculate several values, but now we need an empty table</span>

  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:root</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_binary identifier id'>to_binary</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>

  <span class='object_offset identifier id'>object_offset</span> <span class='assign token'>=</span> <span class='integer val'>8</span>
  <span class='offsets identifier id'>offsets</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='integer val'>0</span><span class='dot token'>.</span><span class='upto identifier id'>upto</span><span class='lparen token'>(</span><span class='@object_table ivar id'>@object_table</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span>
    <span class='offsets identifier id'>offsets</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='object_offset identifier id'>object_offset</span>
    <span class='object_offset identifier id'>object_offset</span> <span class='opasgn op'>+=</span> <span class='@object_table ivar id'>@object_table</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='bytesize identifier id'>bytesize</span>
  <span class='end end kw'>end</span>

  <span class='offsets identifier id'>offsets</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='offset identifier id'>offset</span><span class='bitor op'>|</span>
    <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='Binary constant id'>Binary</span><span class='dot token'>.</span><span class='pack_it_with_size identifier id'>pack_it_with_size</span><span class='lparen token'>(</span><span class='offset_size identifier id'>offset_size</span><span class='comma token'>,</span><span class='offset identifier id'>offset</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span><span class='offset_size identifier id'>offset_size</span><span class='comma token'>,</span> <span class='@object_ref_size ivar id'>@object_ref_size</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;x6CC&quot;</span><span class='rparen token'>)</span>
  <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span><span class='@count_objects ivar id'>@count_objects</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;x4N&quot;</span><span class='rparen token'>)</span>
  <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;x4N&quot;</span><span class='rparen token'>)</span>
  <span class='binary_str identifier id'>binary_str</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span><span class='table_offset identifier id'>table_offset</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;x4N&quot;</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='binary_str identifier id'>binary_str</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Jul 11 11:00:44 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.8  and the 
  <a href="http://github.com/dreamcat4/yard-slipstream">yard-slipstream</a> plugin
	(ruby-1.8.7).
</div>

  </body>
</html>