<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Plist4r::Backend::RubyCocoa</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/custom.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<base id="base_target" target="_top" />
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/autocomplete.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/live.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
		
			<a href="../../object_index.html" target="_self" title="Index (R)">Index (R)</a>
		 &raquo;
    <span class='title'><a href="../../Plist4r.html" target="_self" title="Plist4r (module)">Plist4r</a></span> &raquo; <span class='title'><a href="../Backend.html" target="_self" title="Plist4r::Backend (class)">Backend</a></span>
     &raquo; 
    <span class="title">RubyCocoa</span>
  
  
  <div class="noframes">
    <span class="title"></span>
    <a id="frames_link" class="link_disabled">Frames</a> | 
    <a target="_top" id="noframes_link" class="link_disabled">No Frames</a>
    <span class="title"></span>
  </div>
</div>

      <div id="search2">
  
  
  <div class="search2_center">
    <form class="search2" onsubmit="return false;" action="">
      <input name="q" type="search" placeholder="Search" id="search_box2" size="30" value="" />
    </form>
  </div>
  <script type="text/javascript" charset="utf-8"> 
    $('#search_box2').focus(function(){
      var search_index = relpath + 'search_index.json';
      jQuery.getJSON(search_index, go_data);

      function go_data(adata) {
        $('#search_box2').autocomplete(adata, {
          width: 300,
          matchContains: true,
          formatItem: function(item) {
            return item.text;
          }
        }).result(function(event, item) {
					if (window.location.search) {
	          window.location.href = relpath + $(item.href_tag).attr("href");
					} else {
	          location.href = relpath + $(item.href_tag).attr("href");
					}
        });
      }
    });
  </script> 
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Plist4r::Backend::RubyCocoa
  
  
  
</h1>

<div id="info_box">
  <dl class="box">
    
      
    
      
    
  
    <dt class="r1 last">Defined in:</dt>
		<dd class="r1 last">
  		
  lib/plist4r/backend/ruby_cocoa.rb


		</dd>
  </dl>
</div>
<div class="clear"></div>


	<h3 class="inherited">Class Methods</h3>
	    <ul id="methods_ribbon">
	    
	    
	      <li class="r1"><a href="#from_binary-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.from_binary (method)">from_binary</a></li>
	      
	    
	      <li class="r2"><a href="#from_gnustep-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.from_gnustep (method)">from_gnustep</a></li>
	      
	    
	      <li class="r1"><a href="#from_string-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.from_string (method)">from_string</a></li>
	      
	    
	      <li class="r2"><a href="#from_xml-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.from_xml (method)">from_xml</a></li>
	      
	    
	      <li class="r1"><a href="#open_with_args-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.open_with_args (method)">open_with_args</a></li>
	      
	    
	      <li class="r2"><a href="#read_result_file-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.read_result_file (method)">read_result_file</a></li>
	      
	    
	      <li class="r1"><a href="#ruby_cocoa_exec-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.ruby_cocoa_exec (method)">ruby_cocoa_exec</a></li>
	      
	    
	      <li class="r2"><a href="#ruby_cocoa_wrapper_rb-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.ruby_cocoa_wrapper_rb (method)">ruby_cocoa_wrapper_rb</a></li>
	      
	    
	      <li class="r1"><a href="#to_binary-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.to_binary (method)">to_binary</a></li>
	      
	    
	      <li class="r2"><a href="#to_xml-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.to_xml (method)">to_xml</a></li>
	      
	    
	    </ul>


<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This backend only works on MacOSX. It supports everything except
<tt><a href="Example.html#to_gnustep-class_method" target="_self" title="Plist4r::Backend::Example.to_gnustep (method)">Example.to_gnustep</a></tt>, and saving in the :gnustep file format. This
is Because RubyCocoa uses the NSPropertyListSerialization class, which
doesnt support writing to OpenStep Format.
</p>
<p>
Here we are calling the stock OSX Ruby in a seperate process. It isolates
the runtime from any shared lib (.so) LoadErrors. And allows calling from
other installed Ruby instances (eg REE), which dont usually have RubyCocoa
enabled.
</p>
<p>
This Backend should work for any 10.5 (Leopard), 10.6 (Snow Leopard) Mac
OSX distribution. It will do nothing on non-mac platforms (eg Linux etc).
</p>


  </div>
</div>
<div class="tags">
  <h3>Author:</h3>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
Dreamcat4 (dreamcat4@gmail.com)
</p>
</div>
      
    </li>
  
</ul>

</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first" id="from_binary-class_method">
  <p class="signature first"">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>from_binary</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 247</span>

<span class='def def kw'>def</span> <span class='from_binary identifier id'>from_binary</span> <span class='plist identifier id'>plist</span>
  <span class='from_string identifier id'>from_string</span> <span class='plist identifier id'>plist</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="from_gnustep-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>from_gnustep</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 251</span>

<span class='def def kw'>def</span> <span class='from_gnustep identifier id'>from_gnustep</span> <span class='plist identifier id'>plist</span>
  <span class='from_string identifier id'>from_string</span> <span class='plist identifier id'>plist</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="from_string-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>from_string</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 234</span>

<span class='def def kw'>def</span> <span class='from_string identifier id'>from_string</span> <span class='plist identifier id'>plist</span>
  <span class='require identifier id'>require</span> <span class='string val'>'tempfile'</span>
  <span class='tf identifier id'>tf</span> <span class='assign token'>=</span> <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>&quot;from_string.plist.&quot;</span>
  <span class='tf identifier id'>tf</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='plist identifier id'>plist</span><span class='dot token'>.</span><span class='from_string identifier id'>from_string</span>
  <span class='tf identifier id'>tf</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='tf identifier id'>tf</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
  <span class='return return kw'>return</span> <span class='open_with_args identifier id'>open_with_args</span> <span class='plist identifier id'>plist</span><span class='comma token'>,</span> <span class='filename identifier id'>filename</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="from_xml-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>from_xml</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 243</span>

<span class='def def kw'>def</span> <span class='from_xml identifier id'>from_xml</span> <span class='plist identifier id'>plist</span>
  <span class='from_string identifier id'>from_string</span> <span class='plist identifier id'>plist</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="open_with_args-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>open_with_args</strong>(plist, filename) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


218
219
220
221
222
223
224
225
226
227
228
229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 218</span>

<span class='def def kw'>def</span> <span class='open_with_args identifier id'>open_with_args</span> <span class='plist identifier id'>plist</span><span class='comma token'>,</span> <span class='filename identifier id'>filename</span>
  <span class='require identifier id'>require</span> <span class='string val'>'date'</span>

  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='ruby_cocoa_exec identifier id'>ruby_cocoa_exec</span> <span class='dstring node'>&quot;open(\&quot;#{filename}\&quot;)&quot;</span>
  <span class='case case kw'>case</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='exitstatus identifier id'>exitstatus</span>
  <span class='when when kw'>when</span> <span class='integer val'>0</span>
    <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Plist4r constant id'>Plist4r</span><span class='colon2 op'>::</span><span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='hash identifier id'>hash</span><span class='dot token'>.</span><span class='replace identifier id'>replace</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='read_result_file identifier id'>read_result_file</span><span class='rparen token'>)</span>
    <span class='plist identifier id'>plist</span><span class='dot token'>.</span><span class='import_hash identifier id'>import_hash</span> <span class='hash identifier id'>hash</span>
  <span class='else else kw'>else</span>
    <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error executing #{result[0]}. See stderr for more information&quot;</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='plist identifier id'>plist</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="read_result_file-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>read_result_file</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 180</span>

<span class='def def kw'>def</span> <span class='read_result_file identifier id'>read_result_file</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='@result_file ivar id'>@result_file</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="ruby_cocoa_exec-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Array.html" target="_self" title="Array (class)">Array</a></tt>) <strong>ruby_cocoa_exec</strong>(stdin_str) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Write a temporary script to the filesystem, then execute it
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><a href="../../String.html" target="_self" title="String (class)">String</a></tt>)</span>
      
      
        <span class='name'>stdin_str</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The command to run
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="../../Array.html" target="_self" title="Array (class)">Array</a></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
cmd, status, stdout_result, stderr_result
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 137</span>

<span class='def def kw'>def</span> <span class='ruby_cocoa_exec identifier id'>ruby_cocoa_exec</span> <span class='stdin_str identifier id'>stdin_str</span>
  <span class='rubycocoa_framework identifier id'>rubycocoa_framework</span> <span class='assign token'>=</span> <span class='string val'>&quot;/System/Library/Frameworks/RubyCocoa.framework&quot;</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;RubyCocoa Framework not found. Searched in: #{rubycocoa_framework}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span> <span class='rubycocoa_framework identifier id'>rubycocoa_framework</span>

  <span class='require identifier id'>require</span> <span class='string val'>'tempfile'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'plist4r/mixin/popen4'</span>

  <span class='unless unless kw'>unless</span> <span class='@rb_script ivar id'>@rb_script</span> <span class='andop op'>&amp;&amp;</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='@rb_script ivar id'>@rb_script</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
    <span class='@rb_script ivar id'>@rb_script</span> <span class='assign token'>=</span> <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>&quot;ruby_cocoa_wrapper.rb.&quot;</span>
    <span class='@rb_script ivar id'>@rb_script</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='ruby_cocoa_wrapper_rb identifier id'>ruby_cocoa_wrapper_rb</span>
    <span class='@rb_script ivar id'>@rb_script</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span> <span class='integer val'>0755</span><span class='comma token'>,</span> <span class='@rb_script ivar id'>@rb_script</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
  <span class='end end kw'>end</span>

  <span class='cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='@rb_script ivar id'>@rb_script</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
  <span class='plist4r_root identifier id'>plist4r_root</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='expand_path identifier id'>expand_path</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;..&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;..&quot;</span><span class='rparen token'>)</span>
  <span class='@result_file ivar id'>@result_file</span> <span class='assign token'>=</span> <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;result_file.rb&quot;</span><span class='rparen token'>)</span>
  <span class='@result_file ivar id'>@result_file</span><span class='dot token'>.</span><span class='close identifier id'>close</span>

  <span class='pid identifier id'>pid</span><span class='comma token'>,</span> <span class='stdin identifier id'>stdin</span><span class='comma token'>,</span> <span class='stdout identifier id'>stdout</span><span class='comma token'>,</span> <span class='stderr identifier id'>stderr</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Plist4r constant id'>Plist4r</span><span class='colon2 op'>::</span><span class='Popen4 constant id'>Popen4</span><span class='colon2 op'>::</span><span class='popen4 identifier id'>popen4</span> <span class='lbrack token'>[</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='plist4r_root identifier id'>plist4r_root</span><span class='comma token'>,</span> <span class='@result_file ivar id'>@result_file</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rbrack token'>]</span>

    <span class='stdin identifier id'>stdin</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='stdin_str identifier id'>stdin_str</span>
    <span class='stdin identifier id'>stdin</span><span class='dot token'>.</span><span class='close identifier id'>close</span>

    <span class='ignored identifier id'>ignored</span><span class='comma token'>,</span> <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span><span class='nil nil kw'>nil</span><span class='rbrack token'>]</span>
    <span class='timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='integer val'>15</span>
    <span class='begin begin kw'>begin</span>
      <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='timeout identifier id'>timeout</span><span class='lparen token'>(</span><span class='timeout identifier id'>timeout</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
        <span class='ignored identifier id'>ignored</span><span class='comma token'>,</span> <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='Process constant id'>Process</span><span class='colon2 op'>::</span><span class='waitpid2 identifier id'>waitpid2</span> <span class='pid identifier id'>pid</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='exc identifier id'>exc</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{exc.message}, killing pid #{pid}&quot;</span>
      <span class='Process constant id'>Process</span><span class='colon2 op'>::</span><span class='kill identifier id'>kill</span><span class='lparen token'>(</span><span class='string val'>'TERM'</span><span class='comma token'>,</span> <span class='pid identifier id'>pid</span><span class='rparen token'>)</span>
      <span class='comment val'># Process::kill('HUP', pid)</span>
      <span class='ignored identifier id'>ignored</span><span class='comma token'>,</span> <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='Process constant id'>Process</span><span class='colon2 op'>::</span><span class='waitpid2 identifier id'>waitpid2</span> <span class='pid identifier id'>pid</span>
    <span class='end end kw'>end</span>

    <span class='stdout_result identifier id'>stdout_result</span> <span class='assign token'>=</span> <span class='stdout identifier id'>stdout</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
    <span class='stderr_result identifier id'>stderr_result</span> <span class='assign token'>=</span> <span class='stderr identifier id'>stderr</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>

  <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='stdout_result identifier id'>stdout_result</span><span class='comma token'>,</span> <span class='stderr_result identifier id'>stderr_result</span><span class='rbrack token'>]</span>    
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="ruby_cocoa_wrapper_rb-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>ruby_cocoa_wrapper_rb</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A seperate ruby script, which runs in its own process.
</p>


  </div>
</div>
<div class="tags">
  
  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#ruby_cocoa_exec-class_method" target="_self" title="Plist4r::Backend::RubyCocoa.ruby_cocoa_exec (method)">ruby_cocoa_exec</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 19</span>

<span class='def def kw'>def</span> <span class='ruby_cocoa_wrapper_rb identifier id'>ruby_cocoa_wrapper_rb</span>
  <span class='@ruby_cocoa_wrapper_rb ivar id'>@ruby_cocoa_wrapper_rb</span> <span class='opasgn op'>||=</span> <span class='string val'>&quot;#!/usr/bin/ruby\nraise \&quot;No path given to plist4r\&quot; unless ARGV[0] &amp;&amp; File.exists?(\&quot;\#{ARGV[0]}/plist4r.rb\&quot;)\n\ndir = ARGV[0]\n$LOAD_PATH.unshift dir unless $LOAD_PATH.include?(dir)\n\nrequire 'osx/cocoa'\nrequire 'date'\nrequire 'plist4r/mixin/ordered_hash'\n\n# Property list API.\nmodule OSX\ndef object_to_plist(object, format=nil)\nformat ||= OSX::NSPropertyListXMLFormat_v1_0\ndata, error = OSX::NSPropertyListSerialization.objc_send \\\n:dataFromPropertyList, object,\n:format, format,\n:errorDescription\nraise error.to_s if data.nil?\ncase format\nwhen OSX::NSPropertyListXMLFormat_v1_0,\nOSX::NSPropertyListOpenStepFormat\nOSX::NSString.alloc.initWithData_encoding(data,\nOSX::NSUTF8StringEncoding).to_s\nelse\ndata.bytes.bytestr(data.length)\nend\nend\nmodule_function :object_to_plist\nend\n\nclass OSX::NSObject\ndef to_ruby\ncase self\nwhen OSX::NSDate\nself.to_time\nwhen OSX::NSCFBoolean\nself.boolValue\nwhen OSX::NSNumber\nself.integer? ? self.to_i : self.to_f\nwhen OSX::NSString\nself.to_s\nwhen OSX::NSAttributedString\nself.string.to_s\nwhen OSX::NSArray\nself.to_a.map { |x| x.is_a?(OSX::NSObject) ? x.to_ruby : x }\nwhen OSX::NSDictionary\nh = ::Plist4r::OrderedHash.new\nself.each do |x, y|\nx = x.to_ruby if x.is_a?(OSX::NSObject)\ny = y.to_ruby if y.is_a?(OSX::NSObject)\nh[x] = y\nend\nh\nelse\nself\nend\nend\nend\n\nmodule Plist\ndef write_result_file obj\nFile.open @result_file, 'w' do |o|\no &lt;&lt; obj\nend\nend\n\ndef to_xml input_file\n# to_plist defaults to NSPropertyListXMLFormat_v1_0\nhash = Marshal.load(File.read(input_file))\nx = hash.to_plist\nwrite_result_file x\nend\n\ndef to_binary input_file\n# Here 200 == NSPropertyListBinaryFormat_v1_0\nhash = Marshal.load(File.read(input_file))\nx = hash.to_plist 200\nwrite_result_file x\nend\n\ndef open filename\nplist_dict = ::OSX::NSDictionary.dictionaryWithContentsOfFile(filename)\nunless plist_dict\nplist_array = ::OSX::NSArray.arrayWithContentsOfFile(filename) unless plist_dict\nraise \&quot;Couldnt parse file: \#{filename}\&quot; unless plist_array\nplist_dict = ::Plist4r::OrderedHash.new\nplist_dict[\&quot;Array\&quot;] = plist_array.to_ruby\nend\n\nFile.open @result_file, 'w' do |o|\no.write Marshal.dump(plist_dict.to_ruby)\nend\nend\nend\n\nclass RubyCocoaWrapper\ninclude Plist\n\ndef exec stdin\n@result_file = ARGV[1]\ninstance_eval stdin\nexit 0\nend\nend\n\nstdin = $stdin.read()\nwrapper = RubyCocoaWrapper.new()\nwrapper.exec stdin\n&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="to_binary-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>to_binary</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 201</span>

<span class='def def kw'>def</span> <span class='to_binary identifier id'>to_binary</span> <span class='plist identifier id'>plist</span>
  <span class='require identifier id'>require</span> <span class='string val'>'tempfile'</span>
  <span class='input_file identifier id'>input_file</span> <span class='assign token'>=</span> <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>&quot;input_file.rb.&quot;</span>
  <span class='input_file identifier id'>input_file</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='plist identifier id'>plist</span><span class='dot token'>.</span><span class='to_hash identifier id'>to_hash</span><span class='rparen token'>)</span>
  <span class='input_file identifier id'>input_file</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='ruby_cocoa_exec identifier id'>ruby_cocoa_exec</span> <span class='dstring node'>&quot;to_binary(\&quot;#{input_file.path}\&quot;)&quot;</span>

  <span class='case case kw'>case</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='exitstatus identifier id'>exitstatus</span>
  <span class='when when kw'>when</span> <span class='integer val'>0</span>
    <span class='binary_string identifier id'>binary_string</span> <span class='assign token'>=</span> <span class='read_result_file identifier id'>read_result_file</span>
    <span class='return return kw'>return</span> <span class='binary_string identifier id'>binary_string</span>
  <span class='else else kw'>else</span>
    <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error executing #{result[0]}. See stderr for more information&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
      <div class="method_details " id="to_xml-class_method">
  <p class="signature "">
  
    + (<tt><a href="../../Object.html" target="_self" title="Object (class)">Object</a></tt>) <strong>to_xml</strong>(plist) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plist4r/backend/ruby_cocoa.rb', line 184</span>

<span class='def def kw'>def</span> <span class='to_xml identifier id'>to_xml</span> <span class='plist identifier id'>plist</span>
  <span class='require identifier id'>require</span> <span class='string val'>'tempfile'</span>
  <span class='input_file identifier id'>input_file</span> <span class='assign token'>=</span> <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>&quot;input_file.rb.&quot;</span>
  <span class='input_file identifier id'>input_file</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='plist identifier id'>plist</span><span class='dot token'>.</span><span class='to_hash identifier id'>to_hash</span><span class='rparen token'>)</span>
  <span class='input_file identifier id'>input_file</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='ruby_cocoa_exec identifier id'>ruby_cocoa_exec</span> <span class='dstring node'>&quot;to_xml(\&quot;#{input_file.path}\&quot;)&quot;</span>
  
  <span class='case case kw'>case</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='exitstatus identifier id'>exitstatus</span>
  <span class='when when kw'>when</span> <span class='integer val'>0</span>
    <span class='xml_string identifier id'>xml_string</span> <span class='assign token'>=</span> <span class='read_result_file identifier id'>read_result_file</span>
    <span class='return return kw'>return</span> <span class='xml_string identifier id'>xml_string</span>
  <span class='else else kw'>else</span>
    <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error executing #{result[0]}. See stderr for more information&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>

    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Jul 11 11:00:54 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.8  and the 
  <a href="http://github.com/dreamcat4/yard-slipstream">yard-slipstream</a> plugin
	(ruby-1.8.7).
</div>

  </body>
</html>